@*
 * Copyright 2025 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import actions.SessionRequest
@import controllers.accommodation
@import models.submissions.common.AnswerYes
@import uk.gov.hmrc.govukfrontend.views.html.components.*
@import util.NumberUtil.*
@import util.{DateUtilLocalised, SectionAnswersRowBuilder}


@this(
        govukSummaryList: GovukSummaryList,
        dateUtil: DateUtilLocalised
)


@()(implicit request: SessionRequest[?], messages: Messages)

@sectionAnswers = @{
    SectionAnswersRowBuilder(request.sessionData.accommodationDetails)
}

<h2 class="govuk-heading-m">@messages("label.section.accommodation")</h2>

@sectionAnswers.answers.fold(List.empty)(_.accommodationUnits).zipWithIndex.map { case (accommodationUnit, index) =>

    @govukSummaryList(
        SummaryList(
            card = Some(Card(
                title = Some(CardTitle(Text(messages("accommodation.CYA.unit", index + 1)))),
                actions = Some(Actions(
                    items = Seq(
                        ActionItem(
                            href = s"${controllers.accommodation.routes.AccommodationUnitList6048Controller.remove.url}?idx=$index&from=CYA",
                            content = Text(messages("label.remove"))
                        )
                    ),
                    classes = "govuk-!-font-weight-regular"
                ))
            )),
            rows = sectionAnswers.row("accommodation.CYA.unitDetails",
                _ => Seq(accommodationUnit.unitName, accommodationUnit.unitType)
                .map(_.escapedHtml).mkString("""<p class="govuk-body">""", "<br/> ", "</p>"),
                Call("GET", s"${controllers.accommodation.routes.AccommodationUnit6048Controller.show.url}?idx=$index"), "unitName",
                ("valueAsHtml", _ => None)) ++
                    sectionAnswers.row("accommodation.CYA.availableRooms",
                        _ => accommodationUnit.availableRooms.map(r =>
                            Seq[String](
                                messages("accommodation.CYA.singleBedrooms", r.singleBedrooms.toString),
                                messages("accommodation.CYA.doubleBedrooms", r.doubleBedrooms.toString),
                                messages("accommodation.CYA.bathrooms", r.bathrooms.toString),
                                r.otherAccommodationDescription.getOrElse("").escapedHtml,
                                messages("accommodation.CYA.maxGuestsNumber", r.maxGuestsNumber.toString)
                            )
                            .filterNot(_.isEmpty).mkString("""<p class="govuk-body">""", "<br/> ", "</p>")
                        ),
                        Call("GET", s"${controllers.accommodation.routes.AvailableRooms6048Controller.show.url}?idx=$index"), "singleBedrooms",
                        ("valueAsHtml", _ => None))
        )
    )

}
