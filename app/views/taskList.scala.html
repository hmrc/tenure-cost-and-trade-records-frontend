@*
 * Copyright 2023 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import actions.SessionRequest
@import uk.gov.hmrc.govukfrontend.views.html.components.GovukButton
@import uk.gov.hmrc.govukfrontend.views.html.components.GovukWarningText
@import uk.gov.hmrc.govukfrontend.views.viewmodels.warningtext.WarningText
@import uk.gov.hmrc.govukfrontend.views.viewmodels.content.Text
@import uk.gov.hmrc.govukfrontend.views.html.components.FormWithCSRF


@this(layout: Layout,
        govukButton: GovukButton,
        govukWarningText: GovukWarningText,
        formWithCSRF: FormWithCSRF
)


@()(implicit request: SessionRequest[_], messages: Messages)

@session = @{
 request.sessionData
}

@isLeaseHolder = @{
  true
}

@totalSections = @{
 if(isLeaseHolder) {
  6
 } else {
  5
 }
}

@section1Completed = @{ session.stillConnectedDetails.flatMap(_.checkYourAnswersConnectionToProperty.map(_.checkYourAnswersConnectionToProperty)) }
@section2Completed = @{ session.aboutYouAndTheProperty.flatMap(_.checkYourAnswersAboutTheProperty.map(_.checkYourAnswersAboutYourProperty)) }
@section3Completed = @{ session.aboutTheTradingHistory.flatMap(_.checkYourAnswersAboutTheTradingHistory.map(_.checkYourAnswersAboutTheTradingHistory)) }
@section4Completed = @{ session.aboutFranchisesOrLettings.flatMap(_.checkYourAnswersAboutFranchiseOrLettings.map(_.checkYourAnswersAboutFranchiseOrLettings)) }
@section5Completed = @{ session.aboutLeaseOrAgreementPartOne.flatMap(_.checkYourAnswersAboutYourLeaseOrTenure.map(_.checkYourAnswersAboutYourLeaseOrTenure)) }
@section6Completed = @{ session.additionalInformation.flatMap(_.checkYourAnswersAdditionalInformation.map(_.checkYourAnswersAdditionalInformation)) }

@completedSections = @{
 Seq(
  section1Completed,
  section2Completed,
  section3Completed,
  section4Completed,
  section5Completed,
  section6Completed
 ).count(_.contains("yes"))
}

@declarationStatus = @{
 if(completedSections == totalSections) {
  "complete"
 } else {
  "incomplete"
 }
}

@layout(
 pageHeading = messages("taskList.heading"),
 backLinkUrl = session.lastCYAPageUrl.orElse(Some(LoginController.startPage.url)),
 summary = session.toSummary
) {

 <h2 class="govuk-heading-s govuk-!-margin-bottom-2">Declaration @declarationStatus</h2>
 <p class="govuk-body govuk-!-margin-bottom-7">You have completed @completedSections of @totalSections sections.</p>

    <ol class="app-task-list">

     <li>
      <h2 class="app-task-list__section">
       <span class="app-task-list__section-number">1. </span> @messages("label.section.connectionToTheProperty")
      </h2>

      <ul class="app-task-list__items">
       @includes.taskListItem("are-you-still-connected", "checkYourAnswersConnectionToProperty.connectionStatus.heading",
        controllers.connectiontoproperty.routes.AreYouStillConnectedController.show(),
        section1Completed,
        session.stillConnectedDetails.flatMap(_.addressConnectionType)
       )

       @includes.taskListItem("vacant-properties", "checkYourAnswersConnectionToProperty.vacancyStatus.heading",
        controllers.connectiontoproperty.routes.VacantPropertiesController.show(),
        section1Completed,
        session.stillConnectedDetails.flatMap(_.vacantProperties),
        session.stillConnectedDetails.flatMap(_.addressConnectionType).isEmpty
       )

       @includes.taskListItem("name-of-operator-from-property", "checkYourAnswersConnectionToProperty.occupierDetails.heading",
        controllers.connectiontoproperty.routes.TradingNameOperatingFromPropertyController.show(),
        section1Completed,
        session.stillConnectedDetails.flatMap(_.tradingNameOperatingFromProperty),
        session.stillConnectedDetails.flatMap(_.vacantProperties).isEmpty
       )
      </ul>
     </li>

     <li>
      <h2 class="app-task-list__section">
       <span class="app-task-list__section-number">2. </span> @messages("label.section.aboutTheProperty")
      </h2>

      <ul class="app-task-list__items">
       @includes.taskListItem("about-you", "checkYourAnswersAboutTheProperty.aboutYou.heading",
        controllers.aboutyouandtheproperty.routes.AboutYouController.show(),
        section2Completed,
        session.aboutYouAndTheProperty.flatMap(_.customerDetails),
        session.stillConnectedDetails.flatMap(_.checkYourAnswersConnectionToProperty).isEmpty
       )

       @includes.taskListItem("about-the-property", "checkYourAnswersAboutTheProperty.aboutProperty.heading",
        controllers.aboutyouandtheproperty.routes.AboutThePropertyController.show(),
        section2Completed,
        session.aboutYouAndTheProperty.flatMap(_.propertyDetails),
        session.aboutYouAndTheProperty.flatMap(_.customerDetails).isEmpty
       )

       @includes.taskListItem("licensable-activities", "checkYourAnswersAboutTheProperty.license.heading",
        controllers.aboutyouandtheproperty.routes.LicensableActivitiesController.show(),
        section2Completed,
        session.aboutYouAndTheProperty.flatMap(_.licensableActivities),
        session.aboutYouAndTheProperty.flatMap(_.propertyDetails).isEmpty
       )
      </ul>
     </li>

     <li>
      <h2 class="app-task-list__section">
       <span class="app-task-list__section-number">3. </span> @messages("label.section.aboutYourTradingHistory")
      </h2>
      <ul class="app-task-list__items">
       @includes.taskListItem("about-your-trading-history", "aboutYourTradingHistory.heading",
        controllers.aboutthetradinghistory.routes.AboutYourTradingHistoryController.show(),
        section3Completed,
        session.aboutTheTradingHistory.flatMap(_.occupationAndAccountingInformation),
        session.aboutYouAndTheProperty.flatMap(_.checkYourAnswersAboutTheProperty).isEmpty
       )

       @includes.taskListItem("turnover", "turnover.heading",
        controllers.aboutthetradinghistory.routes.TurnoverController.show(),
        section3Completed,
        session.aboutTheTradingHistory.flatMap(_.turnoverSections),
        session.aboutTheTradingHistory.flatMap(_.occupationAndAccountingInformation).isEmpty
       )
      </ul>

     <li>
      <h2 class="app-task-list__section">
       <span class="app-task-list__section-number">4. </span> @messages("label.section.aboutTheFranchiseLettings")
      </h2>
      <ul class="app-task-list__items">
       <li class="app-task-list__item">
        <span class="app-task-list__task-name">
         <a href="franchise-or-lettings-tied-to-property">Franchise or sub-lets tied to the property</a></span>
        <span class="govuk-tag app-task-list__tag govuk-tag--grey">
         Cannot start yet
        </span>
       </li>
       <li class="app-task-list__item">
        <span class="app-task-list__task-name">
         <a href="catering-operation-or-letting-accommodation">Catering operation or letting accommodation run as separate business from the property</a></span>
        <span class="govuk-tag app-task-list__tag govuk-tag--grey">
         Cannot start yet
        </span>
       </li>
       <li class="app-task-list__item">
        <span class="app-task-list__task-name">Lettings</span>
        <span class="govuk-tag app-task-list__tag govuk-tag--grey">
         Cannot start yet
        </span>
       </li>
      </ul>
     </li>

     @if(isLeaseHolder) {
      <li>
       <h2 class="app-task-list__section">
        <span class="app-task-list__section-number">5. </span> @messages("label.section.aboutYourLeaseOrTenure")
       </h2>
       <ul class="app-task-list__items">
        <li class="app-task-list__item">
         <span class="app-task-list__task-name">
          <a href="about-your-landlord">Tell us about your landlord</a></span>
         <span class="govuk-tag app-task-list__tag govuk-tag--grey">
          Cannot start yet
         </span>
        </li>
        <li class="app-task-list__item">
         <span class="app-task-list__task-name">Changes to your lease</span>
         <span class="govuk-tag app-task-list__tag govuk-tag--grey">
          Cannot start yet
         </span>
        </li>
        <li class="app-task-list__item">
         <span class="app-task-list__task-name">Lease start date and rent paid</span>
         <span class="govuk-tag app-task-list__tag govuk-tag--grey">
          Cannot start yet
         </span>
        </li>
        <li class="app-task-list__item">
         <span class="app-task-list__task-name">What the rent includes</span>
         <span class="govuk-tag app-task-list__tag govuk-tag--grey">
          Cannot start yet
         </span>
        </li>
        <li class="app-task-list__item">
         <span class="app-task-list__task-name">How the rent was calculated</span>
         <span class="govuk-tag app-task-list__tag govuk-tag--grey">
          Cannot start yet
         </span>
        </li>
        <li class="app-task-list__item">
         <span class="app-task-list__task-name">Exclusions, restrictions or incentives</span>
         <span class="govuk-tag app-task-list__tag govuk-tag--grey">
          Cannot start yet
         </span>
        </li>
       </ul>
      </li>
     }

     <li>
      <h2 class="app-task-list__section">
       <span class="app-task-list__section-number">@totalSections. </span> @messages("label.section.additionalInformation")
      </h2>
      <ul class="app-task-list__items">
       @includes.taskListItem("further-information-or-remarks", "furtherInformationOrRemarksTasklist.heading",
        controllers.additionalinformation.routes.FurtherInformationOrRemarksController.show(),
        section6Completed,
        session.additionalInformation.flatMap(_.furtherInformationOrRemarksDetails),
        if (isLeaseHolder) session.aboutLeaseOrAgreementPartOne.flatMap(_.checkYourAnswersAboutYourLeaseOrTenure).isEmpty
        else session.aboutFranchisesOrLettings.flatMap(_.checkYourAnswersAboutFranchiseOrLettings).isEmpty
       )

       @includes.taskListItem("alternate-contact-details", "alternativeContactDetails.heading",
        controllers.additionalinformation.routes.AlternativeContactDetailsController.show(),
        section6Completed,
        session.additionalInformation.flatMap(_.altContactInformation),
        session.additionalInformation.flatMap(_.furtherInformationOrRemarksDetails).isEmpty
       )
      </ul>
     </li>

    </ol>


  @formWithCSRF(action = controllers.routes.FormSubmissionController.submit()) {

    <h2 class="govuk-heading-m">@messages("declaration.heading")</h2>

    <p class="govuk-body">@messages("declaration.information")</p>

    @govukWarningText(WarningText(
      content = Text(messages("hint.declaration"))
    ))

    @includes.continueButton(govukButton, isSend = true)
  }
}
